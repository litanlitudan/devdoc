<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>{{title}}</title>
	<link rel="stylesheet" href="https://unpkg.com/vanilla-jsoneditor/themes/jse-theme-dark.css">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
			background: #0d1117;
			color: #c9d1d9;
			display: flex;
			flex-direction: column;
			height: 100vh;
			overflow: hidden;
		}

		/* Header styles */
		header {
			background: #161b22;
			border-bottom: 1px solid #21262d;
			padding: 12px 20px;
			display: flex;
			align-items: center;
			justify-content: space-between;
			flex-shrink: 0;
		}

		.header-left {
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.file-name {
			font-size: 16px;
			font-weight: 600;
			color: #f0f6fc;
		}

		.file-info {
			font-size: 12px;
			color: #8b949e;
		}

		.header-actions {
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.btn {
			display: inline-flex;
			align-items: center;
			gap: 4px;
			padding: 5px 12px;
			font-size: 12px;
			font-family: inherit;
			line-height: 1.5;
			color: #c9d1d9;
			background-color: #21262d;
			border: 1px solid rgba(240, 246, 252, 0.1);
			border-radius: 6px;
			cursor: pointer;
			text-decoration: none;
			transition: all 0.2s;
		}

		.btn:hover {
			background-color: #30363d;
			border-color: rgba(240, 246, 252, 0.2);
			transform: translateY(-1px);
		}

		.btn:active {
			transform: translateY(0);
		}

		.btn-primary {
			background-color: #238636;
			color: white;
			border-color: rgba(240, 246, 252, 0.1);
		}

		.btn-primary:hover {
			background-color: #2ea043;
			border-color: rgba(240, 246, 252, 0.2);
		}

		/* JSON Editor Container */
		#jsoneditor-container {
			flex: 1;
			padding: 0;
			overflow: hidden;
			background: #0d1117;
		}

		#jsoneditor {
			width: 100%;
			height: 100%;
		}

		/* Override vanilla-jsoneditor styles for better integration */
		.jse-theme-dark {
			--jse-background-color: #0d1117;
			--jse-panel-background: #161b22;
			--jse-panel-border: #21262d;
			--jse-text-color: #c9d1d9;
			--jse-text-color-inverse: #0d1117;
		}

		/* Notification styles */
		.notification {
			position: fixed;
			top: 20px;
			right: 20px;
			background: #238636;
			color: white;
			padding: 12px 16px;
			border-radius: 6px;
			font-size: 14px;
			z-index: 10000;
			opacity: 0;
			transition: opacity 0.3s ease;
			pointer-events: none;
			box-shadow: 0 8px 24px rgba(35, 134, 54, 0.3);
		}

		.notification.show {
			opacity: 1;
		}

		.notification.error {
			background: #da3633;
			box-shadow: 0 8px 24px rgba(218, 54, 51, 0.3);
		}
	</style>
</head>
<body>
	<header>
		<div class="header-left">
			<div class="file-name">{{fileName}}</div>
			<div class="file-info">{{lastModified}}</div>
		</div>
		<div class="header-actions">
			<a href="{{parentDir}}" class="btn" title="Go to folder">üìÅ Folder</a>
			<a href="/api/{{filePath}}" class="btn" download="{{fileName}}" title="Download JSON file">‚¨á Download</a>
		</div>
	</header>

	<div id="jsoneditor-container">
		<div id="jsoneditor"></div>
	</div>

	<div class="notification" id="notification"></div>

	<script type="module">
		import { JSONEditor } from 'https://unpkg.com/vanilla-jsoneditor/standalone.js'

		// Parse JSON data from the server
		const jsonData = {{{jsonData}}}

		// Create the JSON editor
		const editor = new JSONEditor({
			target: document.getElementById('jsoneditor'),
			props: {
				content: {
					json: jsonData
				},
				mode: 'tree',
				mainMenuBar: true,
				navigationBar: true,
				statusBar: true,
				readOnly: false,
				askToFormat: true,
				escapeControlCharacters: true,
				escapeUnicodeCharacters: false,
				flattenColumns: true
			}
		})

		// Show notification helper
		function showNotification(message, isError = false) {
			const notification = document.getElementById('notification')
			notification.textContent = message
			notification.classList.toggle('error', isError)
			notification.classList.add('show')

			setTimeout(() => {
				notification.classList.remove('show')
			}, 2000)
		}

		// Handle window resize
		let resizeTimeout
		window.addEventListener('resize', () => {
			clearTimeout(resizeTimeout)
			resizeTimeout = setTimeout(() => {
				editor.refresh()
			}, 100)
		})

		// Clean up on page unload
		window.addEventListener('beforeunload', () => {
			if (editor) {
				editor.destroy()
			}
		})
	</script>
</body>
</html>
