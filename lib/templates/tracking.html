<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Analytics Tracking</title>
	<link rel="stylesheet" href="{markserv}/templates/markserv.css">
	<style>
		.analytics-container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 20px;
		}

		.stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 20px;
			margin-bottom: 30px;
		}

		.stat-card {
			background: #f6f8fa;
			border: 1px solid #e1e4e8;
			border-radius: 6px;
			padding: 20px;
			text-align: center;
		}

		.stat-value {
			font-size: 2.5em;
			font-weight: bold;
			color: #0366d6;
			margin: 10px 0;
		}

		.stat-label {
			color: #586069;
			font-size: 0.9em;
			text-transform: uppercase;
			letter-spacing: 0.5px;
		}

		.section {
			background: white;
			border: 1px solid #e1e4e8;
			border-radius: 6px;
			padding: 20px;
			margin-bottom: 20px;
		}

		.section-title {
			font-size: 1.5em;
			font-weight: bold;
			margin-bottom: 15px;
			color: #24292e;
		}

		.table {
			width: 100%;
			border-collapse: collapse;
		}

		.table th {
			background: #f6f8fa;
			padding: 12px;
			text-align: left;
			border-bottom: 2px solid #e1e4e8;
			font-weight: 600;
			color: #24292e;
		}

		.table td {
			padding: 12px;
			border-bottom: 1px solid #e1e4e8;
			color: #586069;
		}

		.table tr:hover {
			background: #f6f8fa;
		}

		.badge {
			display: inline-block;
			padding: 3px 8px;
			border-radius: 3px;
			font-size: 0.85em;
			font-weight: 600;
		}

		.badge-markdown { background: #dbedff; color: #0366d6; }
		.badge-html { background: #ffeef0; color: #d73a49; }
		.badge-directory { background: #f1f8ff; color: #005cc5; }
		.badge-text { background: #e8f5e9; color: #28a745; }
		.badge-diff { background: #fff3cd; color: #e36209; }
		.badge-mlir { background: #f3e5f5; color: #6f42c1; }
		.badge-file { background: #e1e4e8; color: #586069; }

		.chart-container {
			display: grid;
			grid-template-columns: repeat(24, 1fr);
			gap: 4px;
			margin: 20px 0;
			height: 150px;
			align-items: end;
		}

		.chart-bar {
			background: #0366d6;
			border-radius: 2px 2px 0 0;
			position: relative;
			transition: all 0.2s;
		}

		.chart-bar:hover {
			background: #0256c7;
			transform: scaleY(1.05);
		}

		.chart-label {
			position: absolute;
			bottom: -25px;
			left: 50%;
			transform: translateX(-50%);
			font-size: 0.7em;
			color: #586069;
			white-space: nowrap;
		}

		.no-data {
			text-align: center;
			color: #586069;
			padding: 40px;
			font-style: italic;
		}

		.timestamp {
			color: #6a737d;
			font-size: 0.85em;
		}

		.path-link {
			color: #0366d6;
			text-decoration: none;
		}

		.path-link:hover {
			text-decoration: underline;
		}

		.header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 30px;
		}

		.back-link {
			color: #0366d6;
			text-decoration: none;
			font-size: 0.95em;
		}

		.back-link:hover {
			text-decoration: underline;
		}
	</style>
</head>
<body>
<article class="markdown-body analytics-container">
	<div class="header">
		<h1>üìä Analytics & Tracking</h1>
		<a href="/" class="back-link">‚Üê Back to Home</a>
	</div>

	<div class="stats-grid">
		<div class="stat-card">
			<div class="stat-label">Total Visits</div>
			<div class="stat-value">{{totalVisits}}</div>
		</div>
		<div class="stat-card">
			<div class="stat-label">Unique Visitors</div>
			<div class="stat-value">{{uniqueVisitors}}</div>
		</div>
		<div class="stat-card">
			<div class="stat-label">Unique Paths</div>
			<div class="stat-value">{{uniquePaths}}</div>
		</div>
	</div>

	{{#if visitsByHour}}
	<div class="section">
		<div class="section-title">Visits by Hour</div>
		<div class="chart-container">
			{{#each visitsByHour}}
			<div class="chart-bar" style="height: {{#if count}}{{count}}%{{else}}2%{{/if}}">
				<div class="chart-label">{{hour}}</div>
			</div>
			{{/each}}
		</div>
	</div>
	{{/if}}

	{{#if topPaths}}
	<div class="section">
		<div class="section-title">Top Visited Paths</div>
		<table class="table">
			<thead>
				<tr>
					<th>Path</th>
					<th style="text-align: right;">Visits</th>
				</tr>
			</thead>
			<tbody>
				{{#each topPaths}}
				<tr>
					<td><a href="{{path}}" class="path-link">{{displayPath}}</a></td>
					<td style="text-align: right; font-weight: 600;">{{count}}</td>
				</tr>
				{{/each}}
			</tbody>
		</table>
	</div>
	{{/if}}

	{{#if visitsByFileType}}
	<div class="section">
		<div class="section-title">Visits by File Type</div>
		<table class="table">
			<thead>
				<tr>
					<th>File Type</th>
					<th style="text-align: right;">Visits</th>
				</tr>
			</thead>
			<tbody>
				{{#each visitsByFileType}}
				<tr>
					<td><span class="badge badge-{{type}}">{{type}}</span></td>
					<td style="text-align: right; font-weight: 600;">{{count}}</td>
				</tr>
				{{/each}}
			</tbody>
		</table>
	</div>
	{{/if}}

	{{#if topVisitors}}
	<div class="section">
		<div class="section-title">Top Visitors (by IP)</div>
		<table class="table">
			<thead>
				<tr>
					<th>IP Address</th>
					<th style="text-align: right;">Visits</th>
					<th style="text-align: right;">Last Seen</th>
				</tr>
			</thead>
			<tbody>
				{{#each topVisitors}}
				<tr>
					<td style="font-family: monospace; font-size: 0.9em;">{{identifier}}</td>
					<td style="text-align: right; font-weight: 600;">{{visits}}</td>
					<td class="timestamp" style="text-align: right;">{{lastSeen}}</td>
				</tr>
				{{/each}}
			</tbody>
		</table>
	</div>
	{{/if}}

	{{#if recentVisits}}
	<div class="section">
		<div class="section-title">Recent Visits (Last 100)</div>
		<table class="table">
			<thead>
				<tr>
					<th>Timestamp</th>
					<th>Path</th>
					<th>Type</th>
					<th>User Agent</th>
					<th>IP</th>
				</tr>
			</thead>
			<tbody>
				{{#each recentVisits}}
				<tr>
					<td class="timestamp">{{timestamp}}</td>
					<td><a href="{{path}}" class="path-link">{{displayPath}}</a></td>
					<td>{{#if fileType}}<span class="badge badge-{{fileType}}">{{fileType}}</span>{{else}}-{{/if}}</td>
					<td style="font-size: 0.85em; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{userAgent}}</td>
					<td style="font-family: monospace; font-size: 0.85em;">{{ip}}</td>
				</tr>
				{{/each}}
			</tbody>
		</table>
	</div>
	{{else}}
	<div class="section">
		<div class="no-data">No page visits recorded yet. Browse some pages to see analytics data.</div>
	</div>
	{{/if}}

	<footer>
		<sup>
			<hr>
			IP: <code style="background: #f6f8fa; padding: 2px 6px; border-radius: 3px; font-family: monospace;">{{currentVisitorIP}}</code> | Timezone: {{timezone}} | PID: {{pid}} | Data resets on server restart
		</sup>
	</footer>
</article>
</body>
</html>
